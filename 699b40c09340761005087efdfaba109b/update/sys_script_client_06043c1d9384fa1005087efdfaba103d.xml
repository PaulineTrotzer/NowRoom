<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_script_client">
    <sys_script_client action="INSERT_OR_UPDATE">
        <active>true</active>
        <applies_extended>false</applies_extended>
        <condition/>
        <description>Calculates and displays the formatted reservation duration when the form is loaded. Ensures that existing records show the correct duration immediately, based on Planned Start and Planned End.</description>
        <field/>
        <global>true</global>
        <isolate_script>false</isolate_script>
        <messages/>
        <name>Saving Duration Format</name>
        <order/>
        <script><![CDATA[function onLoad() {
  // 1) set last valid values (so only if valid)
  var s = g_form.getValue('planned_start'); // ISO "YYYY-MM-DD HH:mm:ss"
  var e = g_form.getValue('planned_end');

  if (s && e && e > s) {
    g_form._lastGoodStart = s;
    g_form._lastGoodEnd   = e;
    g_form.setValue('duration_pretty', prettyDiff(s, e));
  } else {
    g_form.setValue('duration_pretty', '');
  }

  // helper: formatting only (no errors / no reversion!)
  g_form._recalcDurationPrettyAndValidate = function () {
    var startP = g_form.getValue('planned_start');
    var endP   = g_form.getValue('planned_end');
    if (!startP || !endP) { g_form.setValue('duration_pretty', ''); return; }
    if (endP > startP) {
      g_form.setValue('duration_pretty', prettyDiff(startP, endP));
    } else {
      g_form.setValue('duration_pretty', '');
    }
  };

  function prettyDiff(sISO, eISO) {
    // parsing at this point
    var start = new Date(sISO.replace(' ', 'T'));
    var end   = new Date(eISO.replace(' ', 'T'));
    var mins  = Math.round((end - start) / 60000);
    var DAY = 1440, H = 60;
    var d = Math.floor(mins / DAY);
    var h = Math.floor((mins % DAY) / H);
    var m = mins % H;

    if (d) return d + ' ' + (d === 1 ? 'day' : 'days') + (h ? ' ' + h + ' ' + (h === 1 ? 'hour' : 'hours') : '');
    if (h) return h + ' ' + (h === 1 ? 'hour' : 'hours') + (m ? ' ' + m + ' ' + (m === 1 ? 'minute' : 'minutes') : '');
    return m + ' ' + (m === 1 ? 'minute' : 'minutes');
  }

  // making pretty
  g_form._recalcDurationPrettyAndValidate();
}
]]></script>
        <sys_class_name>sys_script_client</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-09-16 18:01:31</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>06043c1d9384fa1005087efdfaba103d</sys_id>
        <sys_mod_count>10</sys_mod_count>
        <sys_name>Saving Duration Format</sys_name>
        <sys_overrides/>
        <sys_package display_value="NowRoom" source="x_1782765_nowroom">699b40c09340761005087efdfaba109b</sys_package>
        <sys_policy/>
        <sys_scope display_value="NowRoom">699b40c09340761005087efdfaba109b</sys_scope>
        <sys_update_name>sys_script_client_06043c1d9384fa1005087efdfaba103d</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-09-30 22:20:57</sys_updated_on>
        <table>x_1782765_nowroom_reservation</table>
        <type>onLoad</type>
        <ui_type>10</ui_type>
        <view/>
    </sys_script_client>
</record_update>
